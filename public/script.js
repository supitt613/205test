const timerDisplay = document.getElementById('timer-display');const startButton = document.getElementById('start-button');const pauseButton = document.getElementById('pause-button');const resetButton = document.getElementById('reset-button');const alarmSound = document.getElementById('alarm-sound');const DEFAULT_DURATION_SECONDS = 23 * 60; // 23 minutesin secondslet timeLeft = DEFAULT_DURATION_SECONDS;let timerInterval;let isRunning = false;function formatTime(seconds) { const minutes = Math.floor(seconds / 60); const remainingSeconds = seconds % 60; return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;}function updateDisplay() { timerDisplay.textContent = formatTime(timeLeft);}function startTimer() { if (isRunning) return; isRunning = true; startButton.disabled = true; pauseButton.disabled = false; resetButton.disabled = false; timerInterval = setInterval(() => { if (timeLeft > 0) { timeLeft--; updateDisplay(); } else { clearInterval(timerInterval); isRunning = false; timerFinished(); } }, 1000);}function pauseTimer() { if (!isRunning) return; isRunning = false; clearInterval(timerInterval); startButton.disabled = false; pauseButton.disabled = true;}function resetTimer() { clearInterval(timerInterval); isRunning = false; timeLeft = DEFAULT_DURATION_SECONDS; updateDisplay(); startButton.disabled = false; pauseButton.disabled = true; resetButton.disabled = false;}async function timerFinished() { alarmSound.play(); alert('時間到！西瓜專注時間結束，是時候休息一下囉！'); // Browser alertawait sendLineNotification(); startButton.disabled = false; pauseButton.disabled = true; resetButton.disabled = false;}async function sendLineNotification() { try { const response = await fetch('/notify', { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ message: '西瓜倒數計時結束！是時候休息一下囉！', duration_minutes: DEFAULT_DURATION_SECONDS / 60, }), }); if (response.ok) { console.log('Line notification and session log sent successfully.'); } else { const errorData = await response.json(); console.error('Failed to send Line notification or log session:', errorData.error); alert('發送 Line 通知或記錄會話失敗！'); } } catch (error) { console.error('Error sending Line notification:', error); alert('與伺服器通訊時發生錯誤，無法發送 Line 通知！'); }}// Event ListenersstartButton.addEventListener('click', startTimer);pauseButton.addEventListener('click', pauseTimer);resetButton.addEventListener('click', resetTimer);// Initial setupupdateDisplay();pauseButton.disabled = true;resetButton.disabled = true;